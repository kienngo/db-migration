version: 0.2

phases:
  install:
    runtime-versions:
      java: corretto21
    commands:
      - echo "Downloading Flyway CLI..."
      - curl -L https://repo1.maven.org/maven2/org/flywaydb/flyway-commandline/10.11.0/flyway-commandline-10.11.0-linux-x64.tar.gz -o flyway.tar.gz
      - tar -xzf flyway.tar.gz
      - mv flyway-10.11.0 /opt/flyway
      - ln -s /opt/flyway/flyway /usr/local/bin/flyway
      - chmod +x /usr/local/bin/flyway

  pre_build:
    commands:
      - echo "Flyway version:"
      - flyway -v
      - echo "Current directory:"
      - pwd
      - echo "List sql files:"
      - ls -R sql
      - echo "Running migration..."
      - flyway -configFiles=flyway.conf migrate

  build:
    commands:
      - echo "No build needed â€“ migration only"

artifacts:
  files:
    - '**/*'
